kind: AdaptiveDialog
modelDescription: T√≥pico para cria√ß√£o de chamados via t√∫nel HTTPS para a API local
beginDialog:
  kind: OnRecognizedIntent
  id: main
  intent:
    triggerQueries:
      - criar chamado
      - abrir ticket
      - preciso de ajuda
      - reportar problema
      - criar ticket
      - novo chamado
      - solicitar suporte
      - minha impressora n√£o funciona
      - problema com impressora
      - impressora com defeito
      - equipamento n√£o funciona
      - problema t√©cnico
      - suporte t√©cnico
      - ajuda com equipamento
      - abrir um chamado
      - fazer um ticket
      - registrar problema
      - tenho um problema
      - preciso de suporte
      - criar um ticket
      - abrir um ticket
      - fazer chamado

  actions:
    - kind: SendActivity
      id: WelcomeMessage
      activity: |
        üé´ **Vamos criar seu chamado!**

        Por favor, forne√ßa as seguintes informa√ß√µes:

    - kind: Question
      id: GetDescription
      alwaysPrompt: true
      variable: Topic.description
      prompt: |
        üìù **Descri√ß√£o do problema** (obrigat√≥rio):

        Descreva detalhadamente o problema ou solicita√ß√£o:
      entity: StringPrebuiltEntity

    - kind: Question
      id: GetImpact
      alwaysPrompt: false
      variable: Topic.impact
      prompt: |
        ‚ö° **Impacto** (opcional):

        Qual o impacto deste problema?
        - BAIXO
        - MEDIO  
        - ALTO

        Digite uma das op√ß√µes ou deixe em branco para MEDIO:
      entity: StringPrebuiltEntity

    - kind: Question
      id: GetLocation
      alwaysPrompt: false
      variable: Topic.location
      prompt: |
        üìç **Localiza√ß√£o** (opcional):

        Onde voc√™ est√° localizado? (ex: Sala 101, Andar 2, etc.)
      entity: StringPrebuiltEntity

    - kind: Question
      id: GetContactPhone
      alwaysPrompt: false
      variable: Topic.contact_phone
      prompt: |
        üìû **Telefone de contato** (opcional):

        Telefone para contato (ex: (11) 99999-9999):
      entity: PhoneNumberPrebuiltEntity

    - kind: SendActivity
      id: ProcessingMessage
      activity: |
        ‚è≥ Processando seu chamado...

    - kind: HttpRequestAction
      id: CreateTicketRequest
      method: Post
      url: https://concentrate-retrieved-farmer-feeling.trycloudflare.com/api/create-ticket-complete
      headers:
        Content-Type: application/json

      body:
        kind: JsonRequestContent
        content: |-
          ={
            title: "Chamado: " & Text(Topic.description),
            description: Topic.description,
            category: "SEGURANCA",
            impact: If(IsBlank(Topic.impact), "MEDIO", Upper(Topic.impact)),
            location: Topic.location,
            contact_phone: Topic.contact_phone,
            requester_email: Topic.user_email
          }

      response: Topic.ticketResult
      responseSchema: Any

    - kind: ConditionGroup
      id: CheckTicketCreation
      conditions:
        - id: TicketSuccess
          condition: =Boolean(Topic.ticketResult.success)
          actions:
            - kind: SendActivity
              id: SuccessMessage
              activity: |
                ‚úÖ **Chamado criado com sucesso!**

                üé´ **N√∫mero do Chamado:** #{Topic.ticketResult.ticket_id}
                üìã **Categoria:** {Topic.ticketResult.details.category}
                üìù **Descri√ß√£o:** {Topic.description}
                ‚ö° **Impacto:** {Topic.impact}
                üìç **Localiza√ß√£o:** {Topic.location}
                üîç **Trace ID:** {Topic.ticketResult.trace_id}

                Seu chamado foi registrado e ser√° atendido em breve!

      elseActions:
        - kind: SendActivity
          id: ErrorMessage
          activity: |
            ‚ùå **Erro ao criar chamado**

            üîç **Trace ID:** {Topic.ticketResult.trace_id}
            ‚ö†Ô∏è **Erro:** {Topic.ticketResult.error}

            Tente novamente ou entre em contato com o suporte.

    - kind: SendActivity
      id: FinalMessage
      activity: üí¨ Posso ajudar com mais alguma coisa?